{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block head %}
	<script src="/static/js/highcharts/highcharts.js"></script>
	<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="excanvas.min.js"></script><![endif]-->
	<script src="/static/js/locales/bootstrap-datetimepicker.it.js"></script>
	<script src="/static/js/jquery.tablesorter.min.js"></script>
	<script src="/static/js/jquery.tablesorter.widgets.min.js"></script>
	<script src="/static/js/jquery.tablesorter.widgets-filter-formatter.min.js"></script>
	<link href="/static/css/theme.bootstrap.css" rel="stylesheet">
	<script src="/static/jquery-ui.min.js"></script>
	<script src="/static/jQRangeSlider/jQDateRangeSlider-withRuler-min.js"></script>
	<link href="/static/jQRangeSlider/css/iThing-min.css" rel="stylesheet">
{% endblock%}


{% block header %}
		<h4 class="header">Statistiche</h4>
{% endblock %}


{% block main %}

<script>
function aggiorna_statistiche(){
	mansioni = "";
	$('.mansioni:checkbox').each(function() {if (this.checked) {
        mansioni = mansioni + '_' + this.value;
    }});
    mansioni = mansioni.substr(1);
    if (mansioni==""){alert("seleziona almeno una mansione!"); return;} 		
    gruppi = "";
	$('.gruppi:checkbox').each(function() {if (this.checked) {
        gruppi = gruppi + '_' + this.value;
    }});
    gruppi = gruppi.substr(1);
    if (gruppi==""){alert("seleziona almeno un gruppo!"); return;}
    $('#loading').removeClass('hidden');
	Dajaxice.statistiche.aggiorna_statistiche(Dajax.process,{'da':$("#id_start").val(),'al':$("#id_stop").val(),'mansioni':mansioni,'gruppi':gruppi});

};

function dettagli_statistiche(id){
	mansioni = "";
	$('.mansioni:checkbox').each(function() {if (this.checked) {
        mansioni = mansioni + '_' + this.value;
    }});
    mansioni = mansioni.substr(1);
	Dajaxice.statistiche.dettaglio_turni(Dajax.process,{'da':$("#id_start").val(),'al':$("#id_stop").val(),'mansioni':mansioni,'id':id});
}

function generali(){
	Dajaxice.statistiche.statistiche_generali(Dajax.process,{'da':$("#id_start").val(),'al':$("#id_stop").val()});
}
$(window).load(function(){

	$(".datetimeinput").datetimepicker({format: 'dd/mm/yyyy hh:ii:ss',autoclose: true,minuteStep: 15,language: 'it'});
	$(".dateinput").datetimepicker({format: 'dd/mm/yyyy',autoclose: true,minView:2,language: 'it'});
});

function reset(){
	$("#id_start").val('');
	$("#id_stop").val('');
	$('.mansioni').prop('checked',true);
	$('.gruppi').prop('checked',true);
	$('#loading').removeClass('hidden');
	Dajaxice.statistiche.aggiorna_statistiche(Dajax.process,{'da':'0','al':'0','mansioni':'all','gruppi':'all'});
};
</script>

<div class="row-fluid">
	<div class="span7">
		<div id="slider" style="margin:0px 60px;"></div>
		</br>
		<div class="box">
			<div class="box-header" onclick="$('#filtro_statistiche').slideToggle();" style="cursor:pointer;">
				<h4><i class="icon-filter"></i> Filtra</h4>
			</div>
			<div class="box-content hide" id="filtro_statistiche">
				{% crispy FiltroStatistiche %}
			</div>
		</div>
	</div>
</div>
<div class="row-fluid">
	<div class="span7" id="stat">
		{% include "statistiche/statistiche.html" %}
	</div>
</div>

<script type="text/javascript">

$(window).load(function(){
	var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sept", "Oct", "Nov", "Dec"];
	anno = new Date().getFullYear();
	$("#slider").dateRangeSlider({
		 	bounds: {min: new Date(anno-3, 0, 1), max: new Date()},
			 defaultValues:{
				min: new Date(anno, 0, 1),
				max: new Date()
			},
			scales: [
				{
				next: function(value){
				var next = new Date(value);
				return new Date(next.setFullYear(value.getFullYear() + 1));
				},
				label: function(value){
				return value.getFullYear();
				},
			},
			{
				next: function(value){
				var next = new Date(value);
				return new Date(next.setMonth(value.getMonth() + 1));
				},
				label: function(value){
				return value.getMonth();
				},
			}

			]
		});
	$("#slider").bind("valuesChanged", function(e, data){
		i=data.values.min;
		f=data.values.max;
		$("#id_start")[0].value = i.getDate()+"/"+(i.getMonth()+1)+"/"+i.getFullYear();
		$("#id_stop")[0].value = f.getDate()+"/"+(f.getMonth()+1)+"/"+f.getFullYear();
		aggiorna_statistiche();
	});

	
});

</script>


{% endblock %}

