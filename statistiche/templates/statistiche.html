{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block head %}
	<script src="/static/js/highcharts/highcharts.js"></script>
	<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="excanvas.min.js"></script><![endif]-->
	<link href="/static/css/datetimepicker.css" rel="stylesheet">
	<script src="/static/js/bootstrap-datetimepicker.min.js"></script>
	<script src="/static/js/locales/bootstrap-datetimepicker.it.js"></script>
	<script src="/static/js/jquery.tablesorter.min.js"></script>
	<script src="/static/js/jquery.tablesorter.widgets.min.js"></script>
	<script src="/static/js/jquery.tablesorter.widgets-filter-formatter.min.js"></script>
	<link href="/static/css/theme.bootstrap.css" rel="stylesheet">
{% endblock%}


{% block header %}
		<h4 class="header">Statistiche</h4>
{% endblock %}


{% block main %}

<script>
function aggiorna_statistiche(){
	mansioni = "";
	$('.mansioni:checkbox').each(function() {if (this.checked) {
        mansioni = mansioni + '_' + this.value;
    }});
    mansioni = mansioni.substr(1);
    if (mansioni==""){alert("seleziona almeno una mansione!"); return;} 		
    gruppi = "";
	$('.gruppi:checkbox').each(function() {if (this.checked) {
        gruppi = gruppi + '_' + this.value;
    }});
    gruppi = gruppi.substr(1);
    if (gruppi==""){alert("seleziona almeno un gruppo!"); return;}
    $('#loading').removeClass('hidden');
	Dajaxice.statistiche.aggiorna_statistiche(Dajax.process,{'da':$("#id_start").val(),'al':$("#id_stop").val(),'mansioni':mansioni,'gruppi':gruppi});

};

function dettagli_statistiche(id){
	mansioni = "";
	$('.mansioni:checkbox').each(function() {if (this.checked) {
        mansioni = mansioni + '_' + this.value;
    }});
    mansioni = mansioni.substr(1);
	Dajaxice.statistiche.dettaglio_turni(Dajax.process,{'da':$("#id_start").val(),'al':$("#id_stop").val(),'mansioni':mansioni,'id':id});
}

$(window).load(function(){

	$(".datetimeinput").datetimepicker({format: 'dd/mm/yyyy hh:ii:ss',autoclose: true,minuteStep: 15,language: 'it'});
	$(".dateinput").datetimepicker({format: 'dd/mm/yyyy',autoclose: true,minView:2,language: 'it'});
});

function reset(){
	$("#id_start").val('');
	$("#id_stop").val('');
	$('.mansioni').prop('checked',true);
	$('.gruppi').prop('checked',true);
	$('#loading').removeClass('hidden');
	Dajaxice.statistiche.aggiorna_statistiche(Dajax.process,{'da':'0','al':'0','mansioni':'all','gruppi':'all'});
};
</script>

<div class="row-fluid">
	<div class="span7">
		<div class="box">
			<div class="box-header">
				<a href="#" class="btn" onclick="$('#filtro_statistiche').slideToggle();"><i class="icon-filter"></i> Filtra</a>
			</div>
			<div class="box-content hide" id="filtro_statistiche">
				{% crispy FiltroStatistiche %}
			</div>
		</div>
	</div>
</div>
<div class="row-fluid">
	<div class="span7" id="stat">
		{% include "statistiche/statistiche.html" %}
	</div>
</div>
{% endblock %}
