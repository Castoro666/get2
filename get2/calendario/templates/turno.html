
{% load template_filters %}


<div class="turno span7" id="turno-{{t.id}}" >
	
	<div class="titolo-turno titolo-turno-{{t.coperto}}" id="titolo-turno-{{t.id}}">
		
		<h5><i class="icon-time icon-white"></i> {{t.inizio|time:"H:i"}} - {{t.fine|time:"H:i"}}</h5><h6> {{t.identificativo}}</h6>
			<div class="dropdown edit-turno">
				<a data-toggle="dropdown" class="dropdown-toggle pull-right " id="modifica-turno-{{t.id}}"><i class="icon-edit icon-white" style="color:white"></i></a>
				<ul class="dropdown-menu pull-right" role="menu" aria-labelledby="dLabel">
					<li><a href="/calendario/turno/modifica/{{t.id}}">Modifica</a></li>
					<li><a href="#">Elimina</a></li>
				</ul>
			</div>
			<div class="dropdown gruppo-turno">
				<a data-toggle="dropdown" class="dropdown-toggle pull-right " id="gruppo-turno-{{t.id}}"><i class="icon-group" style="color:white"></i></a>
				<ul class="dropdown-menu pull-right" role="menu" aria-labelledby="dLabel">
					{%for g in gruppi%}
						<li><a href="/calendario/disponibilita_gruppo/{{t.id}}/{{g.id}}">{{g}}</a></li>
					{%endfor%}
				</ul>
			</div>
	</div>

	{% for requisito in t.tipo.req_tipo_turno.all %}
		{% if not requisito.extra %}
			<div class="mansione-calendario">
				<h6>{{requisito.mansione}}
				{% if not requisito.operatore = "=" or not t|verifica_requisito:requisito  or not requisito.necessario %}
					{% if request.user.is_staff %}
						<a href="/calendario/cerca_persona/{{t.id}}/{{requisito.mansione.id}}">
					{% endif %}
				{% endif %}
				{% if requisito.sufficiente %}
					<span class="badge badge-info pull-right">
				{% elif not requisito.necessario %}
					<span class="badge  pull-right">
				{% elif t|verifica_requisito:requisito  %}
					<span class="badge badge-success pull-right">
				{% else %}
					<span class="badge badge-important pull-right">
				{% endif %}
				{{requisito.operatore}} {{requisito.valore}}</span></a></h6> 
				</div>
				<div class="">
					<ul>
					{% for disp in t.turno_disponibilita.all %}
						{% if disp.mansione = requisito.mansione and disp.tipo = 'Disponibile' %}
							<li class="persona-turno"><i class="icon-user"></i> {{disp.persona}}<a href="/calendario/rimuovi_disponibilita/{{disp.id}}"></a></li>
						{% endif %}
					{% endfor %}
					</ul>
				</div>
		{% endif %}
		{% if requisito.extra %}
			<div class="mansione-calendario extra">{{requisito.mansione}}<small> {{requisito.operatore}} {{requisito.valore}}</small></div>
		{% endif %}
	{% endfor %}
	
	{% for disp in t.turno_disponibilita.all %}
		{% if disp.mansione not in t.mansioni and disp.tipo = 'Disponibile' %}
			{% if forloop.first %}<span class="mansione-calendario">Altre mansioni</span>{% endif  %}
			<span class="persona-turno">{{disp.persona}}<a href="/calendario/rimuovi_disponibilita/{{disp.id}}"><span class="img_rimuovi staff">rimuovi</span></a></span>
		{% endif %}
	{% endfor %}
	
</div>
