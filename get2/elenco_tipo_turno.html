{% extends "base.html" %}
{% load static %}
{% block head %}
<link type="text/css" href="{% static "Aristo/Aristo.css" %}" rel="stylesheet" />
<script type="text/javascript" src="{% static "jquery-ui.js" %}"></script>
{% endblock %}
{% block main %}



<div id="div_tipo_turno"><form action="" method="post" id="form_tipo_turno" accept-charset="utf-8">{% csrf_token %}
    {{ tipo_turno_form.as_p }}
</form>
</div>

	<script>
	$(function() {
		$( "#form_tipo_turno" ).dialog({
			resizable: false,
			modal: true,
			autoOpen: false,
			buttons: {
				"Invia": function() {
					send_form();
				},
				Cancel: function() {
					$( this ).dialog( "close" );
				}
			}
		});
	});
	
	$(document).ready(function(){
		$( "a", ".operazioni" ).button();
		$( ".dettagli_requisito").hide();});
	
	function send_form(){
    	Dajaxice.get2.calendario.tipo_turno_form(Dajax.process,{'form':$('#form_tipo_turno').serialize(true)});
	}
	function send_form_requisiti(form_id){
    	Dajaxice.get2.calendario.requisiti_form(Dajax.process,{'form':$(form_id).serialize(true),'form_id':form_id});
	}
	</script>
<div id="elenco">
<div class="riga"><a href="#" onclick='$("#form_tipo_turno" ).dialog("open");'>aggiungi tipo turno</a></div>
{% for tipo_turno in tipi_turno %}

	<div class="riga" id="tipo_turno-{{tipo_turno.id}}">
	<div class="col">{{tipo_turno}}</div>
	<div class="col operazioni"><a href="#" onclick='$("#dettagli_requisito-{{tipo_turno.id}}").show();'>dettagli</a></div>
	</div>
	<div class="riga" id="requisiti-{{tipo_turno.id}}">

		{% for requisito in tipo_turno.req_tipo_turno.all %}
			
			<script>$(document).ready(function(){
				$("#id_form-operatore-{{requisito.mansione.id}}-{{tipo_turno.id}}").val("{{requisito.operatore|escapejs}}");
				$("#id_form-valore-{{requisito.mansione.id}}-{{tipo_turno.id}}").val("{{requisito.valore}}");
				
			});</script>
			# con javascript devo inzializzare il form ai valori salvati e poi con gli onchange uso dajax per fare modifche
		{% endfor %}
	
	<div class="riga dettagli_requisito" id="dettagli_requisito-{{tipo_turno.id}}">
		<script>$(document).ready(function(){$("#applica-{{tipo_turno.id}}").hide();});</script>
		<form id="form-{{tipo_turno.id}}">
		{% for mansione in mansioni %}
		<div id="form-{{mansione.id}}-{{tipo_turno.id}}">
		
		<p>{{mansione}} 
			<select name="form-operatore" id="id_form-operatore-{{mansione.id}}-{{tipo_turno.id}}" onchange='$("#applica-{{tipo_turno.id}}").show()'>
			<option value="" selected="selected">----</option>
			{% for op,op_val in operatori %}
			<option value="{{op}}">{{op_val}}</option>
			{% endfor %}
			<input type="text" name="fomr-valore" id="id_form-valore-{{mansione.id}}-{{tipo_turno.id}}" onchange='$("#applica-{{tipo_turno.id}}").show()'/>
			</select>
		</p>
		</div>

    	{% endfor %}</form><div id="applica-{{tipo_turno.id}}" onclick="alert('form-{{tipo_turno.id}}')">applica</div>
	</div>
{% endfor %}
</div>
</div>

{% endblock %}
